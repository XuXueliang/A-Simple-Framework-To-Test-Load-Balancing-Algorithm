// JavaScript Document

//experiment_tabs
$(function(){
	$("#experiment_tabs ul li").click(function(){
		$(this).siblings().removeClass("current");
		$(this).addClass("current");
		
		var divInd=$(this).find("a").attr("class");
		$("#experiment_tabs div.tabiv").removeClass("current");
		$("#experiment_tabs div#"+divInd).addClass("current");
		//alert(divInd) 
		})
	})
	
var comment;	
var content1;
var flag = 0;
function find_comment(c)
{
    comment = c;
	//alert(c);
}
	

function init(){  //根据状态显示和隐藏元素
	   var stateObj=$("#experiment_tabs #tab-3 table.report td span.state");
		if(stateObj.text()=="未提交"){
			//alert("in");
			$("#experiment_tabs #tab-3 table.report tr.detail").hide();
			$("#experiment_tabs #tab-3 table.report tr.upload").show();
			}else if(stateObj.text()=="已提交"){
				$("#experiment_tabs #tab-3 table.report tr.detail").show();
				//$("#experiment_tabs #tab-3 table.report tr.upload").hide();
				}
	}
function modify_content(x,exid)
{
    if(x=="yes")
    {
        flag = 1;
        content1 = "实验报告上传成功！";
       
    }
    else
        content1 = "实验报告上传失败！";
	
	 
     $("#experiment_tabs li:eq(0)").removeClass("current");
	 $("#experiment_tabs #tab-1").removeClass("current");
	 $("#experiment_tabs li:eq(2)").addClass("current");
	 $("#experiment_tabs #tab-3").addClass("current");
	
	 
	 var stateObj=$("#experiment_tabs #tab-3 table.report td span.state");
		$(this).noticeDialog({
			title:"提示信息",
			content:content1,
			onInit:function(){       //显示对话框时触发
				$(".dialog .bottom").hide();
				
				setTimeout(function(){
					$(".dialog").remove();
					$(".mask").remove();
					if(flag)
                        stateObj.text("已提交");
					init();	
					//window.location.href = "experiment.php?ExperimentID="+exid;
					},2500)
				
				 
				}
				
				
			})
		

}


//div#tab-3 experiment report
/*function init(userid)
{
	var request = "userid="+userid;
	//alert(request);
	$.getJSON("../php/get_teacher_class.php",request,function(response){
		//alert(response.status);
		if(response.status == 5)
		{
			$.each(response.data, function(j) {
				$("select#chooseClass").append("<option value='"+response.data[j].id+"'>"+response.data[j].name+"</option>");
			});
		}
		else
		{
			alert("您还没有被分配班级！");
		}
	});
}*/
$(function(){
	
	init();	
	
    $("#experiment_tabs #tab-3 .report .viewremark").click(function(){
		/*$(this).remarkDialog({
			title:"教师评语",
			content:comment
			})*/
			//alert(comment);
		})			
	
	})	
var ClassID;

//select class	
$(function(){
	
	$("#experiment_tabs ul li").click(function(){
		//alert("tab");
		var userid = document.getElementById("clickhere").value;
		var request = "userid="+userid;
		//alert(request);
	    $.getJSON("../php/get_teacher_class.php",request,function(response){
		//alert(response.status);
		$("select#chooseClass").html(" <option value=\"select\">请选择</option>");
		$("select#down").html(" <option value=\"select\">请选择</option>");
		if(response.status == 5)
		{
			$.each(response.data, function(j) {
				$("select#down").append("<option value='"+response.data[j].id+"'>"+response.data[j].name+"</option>");
				$("select#chooseClass").append("<option value='"+response.data[j].id+"'>"+response.data[j].name+"</option>");
			});
		}
		else
		{
			alert("您还没有被分配班级！");
		}
	  });
	})
	$("#experiment_tabs .reportlist select,#experiment_tabs .downloadbatch select").change(function(){
		//alert($(this).find(":selected").text())
			var obj1 = document.getElementById("chooseClass");
			var index1 = obj1.selectedIndex;
			classID = obj1.options[index1].value;
			var className = obj1.options[index1].text;
			var ExperimentID = document.getElementById("click2").value;
			//alert(classID);
			if(classID != "select")
			{
					var request = "classID="+classID+"&ExperimentID="+ExperimentID;
					
					/////////////////////////////////////////////
					$("#report").html("");
					 $.getJSON("../php/get_class_report.php",request,function(response){
						//alert(response.status);
						if(response.status == 5)
						{
							var table = $("#report");
							$.each(response.data, function(j) {
								table.append("<tr><td>"+j+"</td><td>"+className+"</td> <td>"+response.data[j].StudentID+"</td> <td>"+response.data[j].snumber+"</td><td>"+response.data[j].UserName+"</td><td>"+response.data[j].submit_state+"</td><td><a href='"+response.data[j].path+"'>下载</a></td><td>"+response.data[j].grade+"</td></tr>");
							});
						}
						else
						{
							alert('暂无记录！');
						}
					 
					 });
					  ///////////////////////////////
			}
		  
		})
	})	
	
$(function(){
	$("#experiment_tabs .grading").click(function(){
		alert("click");
		$(this).gradingDialog({
			title:"实验报告评分",
			 onConfirm2:function(str){
				 alert(str)
				 }
			});
		})
	})	
		